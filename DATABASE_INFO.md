# Cakesman Bakery - Database Information

## Database Overview

Your customer login information and all data is stored in **MongoDB**, a NoSQL database.

### Connection Details
- **Database Location**: Local MongoDB instance
- **Connection String**: `mongodb://localhost:27017/cakesman`
- **Database Name**: `cakesman`
- **Server**: `localhost` (your computer)
- **Port**: `27017` (default MongoDB port)

---

## User/Customer Collection

### Collection Name: `users`

When a customer signs up or logs in, their information is saved in the **Users** collection with the following structure:

```javascript
{
  _id: ObjectId,                    // Unique identifier (auto-generated by MongoDB)
  name: String,                     // Customer's full name
  email: String,                    // Customer's email (unique - no duplicates)
  password: String,                 // Password (encrypted using bcryptjs)
  phone: String,                    // Phone number (optional)
  address: String,                  // Delivery address (optional)
  city: String,                     // City (optional)
  isAdmin: Boolean,                 // Is this an admin? (false for customers, true for admins)
  createdAt: Date,                  // Account creation timestamp
  updatedAt: Date                   // Last update timestamp
}
```

### Example Customer Record:
```json
{
  "_id": "507f1f77bcf86cd799439011",
  "name": "John Doe",
  "email": "john@example.com",
  "password": "$2a$10$encrypted_password_hash",
  "phone": "+91 9876543210",
  "address": "123 Main Street",
  "city": "Varanasi",
  "isAdmin": false,
  "createdAt": "2025-12-04T10:30:00.000Z",
  "updatedAt": "2025-12-04T10:30:00.000Z"
}
```

### Security Features:
- **Password Encryption**: Passwords are hashed using `bcryptjs` (salt rounds: 10)
- **Email Uniqueness**: Each email can only be used for one account
- **JWT Authentication**: Login tokens are stored in the browser's localStorage, not in the database

---

## Other Collections

### 1. Products Collection
**Collection Name**: `products`

Stores all cake and pastry information:
```javascript
{
  _id: ObjectId,
  name: String,                     // Product name
  description: String,              // Product description
  category: String,                 // "Cakes" or "Cupcakes" etc.
  subcategory: String,              // "Chocolate Cakes", "Vanilla Cakes" etc.
  basePrice: Number,                // Base price in rupees
  image: String,                    // Image URL
  flavors: Array,                   // Available flavors with price multipliers
  sizes: Array,                     // Available sizes with price multipliers
  eggOptions: Array,                // Egg/vegan options with price multipliers
  stock: Number,                    // Quantity available
  available: Boolean,               // Is the product available?
  featured: Boolean,                // Is it a featured product?
  rating: Number,                   // Customer rating
  reviews: Array,                   // Customer reviews
  createdAt: Date,
  updatedAt: Date
}
```

**Current Products**: 9 demo cakes are seeded in the database
- Chocolate Cake - ‚Çπ500
- Vanilla Cake - ‚Çπ400
- Red Velvet Cake - ‚Çπ600
- Strawberry Cake - ‚Çπ550
- Black Forest Cake - ‚Çπ700
- Cheesecake - ‚Çπ650
- Carrot Cake - ‚Çπ480
- Chocolate Cupcakes - ‚Çπ300
- Vanilla Cupcakes - ‚Çπ250

### 2. Orders Collection
**Collection Name**: `orders`

Stores customer orders:
```javascript
{
  _id: ObjectId,
  userId: ObjectId,                 // Reference to User
  items: Array,                     // Array of ordered items
  totalPrice: Number,               // Total order amount
  status: String,                   // "pending", "confirmed", "shipped", "delivered"
  deliveryAddress: String,
  customerPhone: String,
  notes: String,
  createdAt: Date,
  updatedAt: Date
}
```

### 3. Cart Collection
**Collection Name**: `carts`

Stores shopping carts (temporary):
```javascript
{
  _id: ObjectId,
  userId: ObjectId,                 // Reference to User
  items: Array,                     // Cart items
  createdAt: Date,
  updatedAt: Date
}
```

---

## Backend Storage Structure

### File Structure:
```
backend/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ User.js                    // User/Customer schema
‚îÇ   ‚îú‚îÄ‚îÄ Product.js                 // Product schema
‚îÇ   ‚îú‚îÄ‚îÄ Order.js                   // Order schema
‚îÇ   ‚îî‚îÄ‚îÄ Cart.js                    // Cart schema
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ authController.js          // Login/Register logic
‚îÇ   ‚îú‚îÄ‚îÄ productController.js       // Product CRUD
‚îÇ   ‚îú‚îÄ‚îÄ orderController.js         // Order logic
‚îÇ   ‚îî‚îÄ‚îÄ cartController.js          // Cart logic
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js              // /api/auth endpoints
‚îÇ   ‚îú‚îÄ‚îÄ productRoutes.js           // /api/products endpoints
‚îÇ   ‚îú‚îÄ‚îÄ orderRoutes.js             // /api/orders endpoints
‚îÇ   ‚îî‚îÄ‚îÄ cartRoutes.js              // /api/cart endpoints
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js                    // JWT authentication middleware
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ db.js                      // Database configuration
‚îú‚îÄ‚îÄ .env                           // Environment variables
‚îî‚îÄ‚îÄ server.js                      // Main server file
```

---

## Frontend Storage Structure

### Browser LocalStorage:
Customer login information on the frontend is also stored in the browser's **localStorage**:

```javascript
// Stored when customer logs in:
localStorage.getItem('authToken')     // JWT token (for API authentication)
localStorage.getItem('user')          // User object (stringified JSON)
localStorage.getItem('cart')          // Shopping cart items (stringified JSON)
```

### Shopping Cart Storage:
Cart items are stored in browser localStorage with this structure:
```javascript
[
  {
    cartId: "unique-id-timestamp-random",
    productId: "mongoObjectId",
    name: "Chocolate Cake",
    price: 500,
    image: "image-url",
    quantity: 1,
    flavor: "Dark Chocolate",  // optional
    size: "Medium",            // optional
    eggOption: "No Eggs"       // optional
  }
]
```

---

## API Endpoints for Authentication

### Register a Customer:
```
POST /api/auth/register
Body: {
  name: "John Doe",
  email: "john@example.com",
  password: "password123",
  phone: "+91 9876543210"
}
Response: {
  token: "jwt_token",
  user: { id, name, email, phone, isAdmin }
}
```

### Login:
```
POST /api/auth/login
Body: {
  email: "john@example.com",
  password: "password123"
}
Response: {
  token: "jwt_token",
  user: { id, name, email, phone, isAdmin }
}
```

### Get Current User:
```
GET /api/auth/me
Headers: { Authorization: "Bearer jwt_token" }
Response: { User object }
```

---

## Admin Credentials

Default admin account (created during seeding):
- **Email**: `admin@cakesman.com`
- **Password**: `admin123`
- **isAdmin**: `true`

This account has access to:
- Product management (add, edit, delete)
- Order management
- Customer management
- Dashboard

---

## How Data Flows

### 1. Customer Registration:
1. User fills registration form on frontend
2. Frontend sends POST request to `/api/auth/register`
3. Backend validates and creates User document in MongoDB
4. Password is encrypted using bcryptjs before saving
5. JWT token is returned to frontend
6. Frontend saves token and user info to localStorage

### 2. Customer Login:
1. User enters email and password
2. Frontend sends POST request to `/api/auth/login`
3. Backend finds user by email in MongoDB
4. Backend compares entered password with encrypted password
5. If match, JWT token is generated and returned
6. Frontend stores token in localStorage for future API calls

### 3. Adding to Cart:
1. Customer clicks "Add" button on product
2. Frontend generates unique cartId
3. Cart item is added to browser's localStorage
4. Frontend shows toast notification

### 4. Placing Order:
1. Customer completes checkout form
2. Frontend sends POST request to `/api/orders`
3. Backend creates Order document in MongoDB
4. Order is linked to the customer via userId
5. Cart is cleared from localStorage
6. Order confirmation is shown to customer

---

## Database Advantages

- **NoSQL**: Flexible schema - easy to add new fields
- **Fast**: Quick read/write operations
- **Scalable**: Can handle large amounts of data
- **Local**: Running locally on your computer - no external server needed
- **Free**: MongoDB Community Edition is open-source

---

## Important Notes

‚ö†Ô∏è **Current Setup**:
- Database runs locally on `localhost:27017`
- Database is only accessible from your computer
- When you deploy to production, you'll need to migrate to **MongoDB Atlas** (cloud database)

üìù **For Production Deployment**:
1. Create free account on MongoDB Atlas
2. Update `MONGO_URI` in `.env` with Atlas connection string
3. Deploy backend to a cloud server (Railway, Render, Heroku)
4. Update frontend API endpoints to point to production backend

---

Generated: December 5, 2025
